<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ðŸ“Š Historique des Logs</title>
<link rel="stylesheet" href="style.css">
<style>
body{font-family:Arial,sans-serif;margin:24px;font-size:14px;}
table{border-collapse:collapse;width:100%;}
th,td{border:1px solid #AAA;padding:8px;text-align:left;}
th{background:#EEE;}
</style>
</head>
<body>

<h1>ðŸ“Š Historique des Ã‰vÃ©nements</h1>
<a href="index.html" class="btn">â¬… Retour tableau de bord</a>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Four</th>
      <th>Chambre</th>
      <th>Zone</th>
      <th>Label</th>

      <!-- === AJOUT PRIORITÃ‰ (UTILISATEUR) === -->
      <th>Utilisateur</th>
      <!-- === FIN AJOUT PRIORITÃ‰ === -->

      <th>Date / Heure</th>
    </tr>
  </thead>
  <tbody id="log-body"></tbody>
</table>

<script>
fetch("/api/events")
  .then(r=>r.json())
  .then(data=>{
    if(!data.ok) return;

    const tb = document.getElementById("log-body");
    tb.innerHTML = "";

    data.events.forEach(ev => {
      const tr = document.createElement("tr");

      const date = new Date(ev.ts)
        .toLocaleString("fr-CA",{hour12:false});

      tr.innerHTML = `
        <td>${ev.type}</td>
        <td>${ev.four}</td>
        <td>${String(ev.chambre).padStart(2,"0")}</td>
        <td>${ev.zone}</td>
        <td>${ev.label || ""}</td>

        <!-- === AJOUT PRIORITÃ‰ (AFFICHE USER) === -->
        <td><b>${ev.source || "?"}</b></td>
        <!-- === FIN AJOUT PRIORITÃ‰ === -->

        <td>${date}</td>
      `;

      tb.appendChild(tr);
    });
  })
  .catch(err=>{
    console.error("Erreur chargement historique:", err);
  });
</script>

</body>
</html>
